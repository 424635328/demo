name: 'Sync: Create PR from test to main'

# è§¦å‘æ¡ä»¶
on:
  schedule:
    # åŒ—äº¬æ—¶é—´æ¯å‘¨ä¸€ä¸Šåˆ 9 ç‚¹ï¼ˆUTC æ—¶é—´å‡Œæ™¨ 1 ç‚¹ï¼‰è¿è¡Œ
    - cron: '0 1 * * 1'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  # ç¬¬ä¸€éƒ¨åˆ†ï¼šåˆ›å»ºæˆ–æ›´æ–° Pull Request
  create_pull_request:
    runs-on: ubuntu-latest
    outputs:
      # è¾“å‡º PR å·ç ï¼Œä¾›åç»­ä»»åŠ¡ä½¿ç”¨ (åœ¨æœ¬å·¥ä½œæµä¸­ï¼Œæ­¤è¾“å‡ºä¸ç›´æ¥è¢«æ¶ˆè´¹ï¼Œä½†ä¿ç•™æ— å¦¨)
      pr_number: ${{ steps.cpr.outputs.pull-request-number }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4 # ğŸ‘ˆ æ·»åŠ è¿™ä¸€è¡Œï¼Œå°†ä»£ç åº“æ£€å‡º

      - name: Create Pull Request from test to main
        id: cpr
        uses: peter-evans/create-pull-request@v7
        with:
          # ä½¿ç”¨ GitHub App çš„ Tokenï¼Œæƒé™æ›´å®‰å…¨
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: sync test branch to main"
          title: "ğŸ¤– Sync: Merge `test` into `main`"
          body: |
            This is an automated PR to sync changes from the `test` branch to `main`.
            
            **Review carefully before merging!**
            
            - Vercel preview will be available below.
            - All checks must pass before this can be merged.
          head: test  # æºåˆ†æ”¯
          base: main  # ç›®æ ‡åˆ†æ”¯
          labels: "automated-pr, sync" # è‡ªåŠ¨ç»™ PR æ‰“ä¸Šæ ‡ç­¾ï¼Œæ–¹ä¾¿è¿‡æ»¤
          assignees: "424635328" # è‡ªåŠ¨æŒ‡æ´¾ç»™ä½ è‡ªå·±å®¡æŸ¥ (è¯·æ›¿æ¢ä¸ºä½ çš„ GitHub ç”¨æˆ·åæˆ– ID)
          reviewers: "424635328" # è‡ªåŠ¨è¯·æ±‚ä½ å®¡æŸ¥ (è¯·æ›¿æ¢ä¸ºä½ çš„ GitHub ç”¨æˆ·åæˆ– ID)
          draft: false # åˆ›å»ºä¸€ä¸ªå¯ç›´æ¥å®¡æŸ¥çš„ PRï¼Œè€Œä¸æ˜¯è‰ç¨¿
          update: true # å¦‚æœå·²å­˜åœ¨ç›¸åŒçš„PRï¼Œåˆ™æ›´æ–°å®ƒè€Œä¸æ˜¯åˆ›å»ºæ–°çš„

# æ³¨æ„ï¼šå…³äº PR ä¸Šçš„æ£€æŸ¥ (æµ‹è¯•å’Œæ„å»º)
# è¿™ä¸€éƒ¨åˆ†åº”è¯¥åœ¨å¦ä¸€ä¸ªå·¥ä½œæµæ–‡ä»¶ (ä¾‹å¦‚ `.github/workflows/pull-request-checks.yml`) ä¸­å®šä¹‰ï¼Œ
# ç›‘å¬ `pull_request` äº‹ä»¶ã€‚GitHub Actions ä¼šè‡ªåŠ¨è§¦å‘å®ƒï¼Œä¸éœ€è¦åœ¨æ­¤å¤„æ˜¾å¼åœ°é“¾æ¥æˆ–è°ƒç”¨ã€‚